@model Fiap.Ex02.MVC.Web.ViewModels.AlunoViewModel
@{
    ViewBag.Title = "Cadastrar";
}

@HelperLayout.Titulo("Cadastrar Aluno")

@HelperLayout.Mensagem(Model.Mensagem, Model.TipoMensagem)

@Html.ValidationSummary()

<div class="row">
    <div class="col-md-12">
        @using (Html.BeginForm())
        {
            <div class="form-group has-feedback">                
                @Html.LabelFor(a => a.Nome)
                @Html.TextBoxFor(a => a.Nome, new { @class = "input-validation-error form-control" })
                @Html.ValidationMessageFor(a => a.Nome)                
            </div>
            
            <div class="form-group">
                @Html.LabelFor(a => a.DataNascimento)
                @Html.TextBoxFor(a => a.DataNascimento, "{0:dd/MM/yyyy}", new { @class="form-control"})
                @Html.ValidationMessageFor(a=>a.DataNascimento)
            </div>

            <div class="form-group">
                @Html.LabelFor(a=>a.GrupoId)
                @Html.DropDownListFor(a=>a.GrupoId, Model.ListaGrupo, "Selecione", new { @class="form-control"})
                @Html.ValidationMessageFor(a=>a.GrupoId)
            </div>

            <div class="form-group">
                @Html.LabelFor(a=>a.Bolsa)
                @Html.CheckBoxFor(a=>a.Bolsa)
                @Html.ValidationMessageFor(a=>a.Bolsa)
            </div>

            <div class="form-group">
                @Html.LabelFor(a=>a.Desconto)
                @Html.TextBoxFor(a=>a.Desconto, new {@class="form-control" })
                @Html.ValidationMessageFor(a=>a.Desconto)
            </div>

            <div class="form-group">
                @HelperForm.Submit("Salvar", "btn btn-success")
                @HelperForm.Reset("Limpar", "btn btn-danger")                
            </div>
        }
    </div>
</div>

@section scripts{
    <script>
        $().ready(function () {
            $("#DataNascimento").datepicker({ dateFormat: "dd/mm/yy"});                        
            $(".selector").datepicker("option", "dateFormat", "dd/mm/yy");

            if ($("#Bolsa").attr("checked") == "checked") {
                $("#Desconto").parent().css("display", "block");
            } else {
                $("#Desconto").parent().css("display", "none");
            }

            $("#Bolsa").click(function () {
                $("#Desconto").parent().slideToggle();
                $("#Desconto").focus();
            });           

            //buscar se nome já existe com ajax
            $("#Nome").blur(function () {                
                $.ajax({
                    url: '@Url.Action("BuscarNome", "Aluno")',
                    type: "get",
                    data: {nome: $("#Nome").val() },
                    success: function(data){
                        if(data.ok){
                            $('.input-validation-error').parents('.form-group').removeClass('has-success').addClass('has-error');
                            $('.input-validation-error').parents('.form-group').find('i').remove();
                            $('.input-validation-error').parents('.form-group').append("<i class=\"glyphicon glyphicon-remove col-sm-pull-2 form-control-feedback\"></i>");
                            //console.log("achou nome");
                        }else{                            
                            $('.input-validation-error').parents('.form-group').removeClass('has-error').addClass('has-success');
                            $('.input-validation-error').parents('.form-group').find('i').remove();
                            $('.input-validation-error').parents('.form-group').append("<i class=\"glyphicon glyphicon-ok col-sm-pull-2 form-control-feedback\"></i>");
                            //console.log("nao achou nome");
                        }
                    },
                    error: function(){
                        $('.input-validation-error').parents('.form-group').addClass('has-error');
                        $('.input-validation-error').parents('.form-group').find('i').remove();
                        $('.input-validation-error').parents('.form-group').append("<i class=\"glyphicon glyphicon-remove col-sm-pull-2 form-control-feedback\"></i>");
                    }
                });
            });           
            

            //validações
            //$('.input-validation-error').parents('.form-group').addClass('has-error');

        });        
    </script>    
}

